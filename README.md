# use-atom

[![Build Status](https://travis-ci.com/dai-shi/use-atom.svg?branch=master)](https://travis-ci.com/dai-shi/use-atom)
[![npm version](https://badge.fury.io/js/use-atom.svg)](https://badge.fury.io/js/use-atom)
[![bundle size](https://badgen.net/bundlephobia/minzip/use-atom)](https://bundlephobia.com/result?p=use-atom)

Recoil inspired implementation with use-context-selector

## Introduction

I have been developing a library called
[use-context-selector](https://github.com/dai-shi/use-context-selector).
[Recoil](https://recoiljs.org) makes me wonder if the atom abstraction
can be implemented with useContextSelector.
The good news is use-context-selector is CM ready (v1 with hack and
v2 with useMutableSource.)

This library provides a few functions and React hooks,
and Recoil subset API of them.
One of the biggest difference from Recoil is
an atom doesn't require the string key.
Hence, there's no support for persistant state
and url encoded state (yet).

Some other limitations:
- No way to clean up registered atoms
- useTransition doesn't work as expected
- async `set` can't be in a transition
- deriveAtom (= `selector` in Recoil) leads to `null` default value

## Install

```bash
npm install use-atom
```

## Usage (useAtom)

```javascript
import React from 'react';
import ReactDOM from 'react-dom';

import { Provider, createAtom, useAtom } from 'use-atom';

const countAtom = createAtom({ default: 0 });
const textAtom = createAtom({ default: 'hello' });

const Counter = () => {
  const [count, setCount] = useAtom(countAtom);
  return (
    <div>
      {Math.random()}
      <div>
        <span>Count: {count}</span>
        <button type="button" onClick={() => setCount(count + 1)}>+1</button>
        <button type="button" onClick={() => setCount((c) => c - 1)}>-1</button>
      </div>
    </div>
  );
};

const TextBox = () => {
  const [text, setText] = useAtom(textAtom);
  return (
    <div>
      {Math.random()}
      <div>
        <span>Text: {text}</span>
        <input value={text} onChange={(event) => setText(event.target.value)} />
      </div>
    </div>
  );
};

const App = () => (
  <Provider>
    <h1>Counter</h1>
    <Counter />
    <Counter />
    <h1>TextBox</h1>
    <TextBox />
    <TextBox />
  </Provider>
);
```

## Usage (Recoil subset API)

```javascript
import React from 'react';
import ReactDOM from 'react-dom';

import { RecoilRoot, atom, useRecoilState } from 'use-atom';

const countAtom = atom({ key: 'count', default: 0 });
const textAtom = atom({ key: 'text', default: 'hello' });

const Counter = () => {
  const [count, setCount] = useRecoilState(countAtom);
  return (
    <div>
      {Math.random()}
      <div>
        <span>Count: {count}</span>
        <button type="button" onClick={() => setCount(count + 1)}>+1</button>
        <button type="button" onClick={() => setCount((c) => c - 1)}>-1</button>
      </div>
    </div>
  );
};

const TextBox = () => {
  const [text, setText] = useRecoilState(textAtom);
  return (
    <div>
      {Math.random()}
      <div>
        <span>Text: {text}</span>
        <input value={text} onChange={(event) => setText(event.target.value)} />
      </div>
    </div>
  );
};

const App = () => (
  <RecoilRoot>
    <h1>Counter</h1>
    <Counter />
    <Counter />
    <h1>TextBox</h1>
    <TextBox />
    <TextBox />
  </RecoilRoot>
);
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

TODO

## Examples

The [examples](examples) folder contains working examples.
You can run one of them with

```bash
PORT=8080 npm run examples:01_minimal
```

and open <http://localhost:8080> in your web browser.

You can also try them in codesandbox.io:
[01](https://codesandbox.io/s/github/dai-shi/use-atom/tree/master/examples/01_minimal)
[02](https://codesandbox.io/s/github/dai-shi/use-atom/tree/master/examples/02_typescript)
[03](https://codesandbox.io/s/github/dai-shi/use-atom/tree/master/examples/03_async)
